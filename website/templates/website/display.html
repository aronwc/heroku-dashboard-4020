<!DOCTYPE html>
<html>
<head>
    <title>Like Post App</title>
</head>

<body>
  {% csrf_token %}
  <div class="col-md-6">
    <div class="form-group">
      <label for="inputStatus">Court</label>
      <select id="question-subject" name="question-subject" class="form-control-sm custom-select" method="get">
        <option >Choose a court</option>
        {% for court in courts %}
        <option id="{{court}}" value="{{court}}">{{court}}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  
  <div class="col-md-6">
    <div class="form-group">
      <label for="inputStatus">Question</label>
      <select id="question-topic" class="form-control-sm custom-select" name="topic">
        <option selected disabled>Choose a question</option>
      </select>
    </div>
  </div>


  {% block javascript %}
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
  <script >
      $('select[name=question-subject]').change(function () {
          const courtId = $(this).val();  // get the selected subject ID from the HTML dropdown list 
          $.ajax({                       // initialize an AJAX request
              type: "get",
              url: '{% url "website:get_topics_ajax" %}',
              data: {
                  'court_id': JSON.stringify(courtId)//,       // add the court id to the POST parameters
                  //'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
              },
              success: function (data) {   // `data` is from `get_topics_ajax` view function
                  let html_data = '<option value="">---------</option>';
                  data.forEach(function (data) {
                      html_data += `<option value="${data}">${JSON.stringify(data.question_text)}</option>`
                  });
                  $('select[name=topic]').html(html_data); // replace the contents of the topic input with the data that came from the server
              }
          });
      });
  </script>
  {% endblock javascript %}

</body>
</html>