
<!DOCTYPE html>




<html>
<head>
    <title>Dashboard</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
<!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
  </head>


<body>
  {% csrf_token %}

  <!-- Drop down for court -->
  <div class="col-md-6">
    <div class="form-group">
      <label for="inputStatus">Court</label>
      <select id="court-dropdown" name="court-dropdown" class="form-control-sm custom-select" method="get" multiple>
        <option selected disabled>Choose court(s)</option>
        {% for court in courts %}
        <option id="{{court}}" value="{{court}}">{{court}}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <!-- Drop down for year -->
  <div class="col-md-6">
    <div class="form-group">
      <label for="inputStatus">Year</label>
      <select id="year-dropdown" name="year-dropdown" class="form-control-sm custom-select" method="get" multiple>
        <option selected disabled>Choose year(s)</option>
        {% for year in years %}
        <option id="{{court}}" value="{{court}}">{{year}}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <!-- Drop down for question -->
  <div class="col-md-6">
    <div class="form-group">
      <label for="inputStatus">Question</label>
      <select id="question-dropdown" class="form-control-sm custom-select" name="question-dropdown">
        <option selected disabled>Choose a question</option>
      </select>
    </div>
  </div>


  {% block javascript %}
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

  <script >
    // whenever court-dropdown or year-dropdown is changed (i.e. clicked), execute this
    $('select[name=court-dropdown], select[name=year-dropdown]').change(function () {
          const court_s = $('select[name=court-dropdown]').val();  // get the selected courts from the HTML dropdown list 
          const year_s = $('select[name=year-dropdown]').val();
          $.ajax({                       // initialize an AJAX request
              type: "get",
              url: '{% url "website:get_years_ajax" %}',
              data: {
                  'courts': JSON.stringify(court_s), //,       // add the year id to the POST parameters
                  'years': JSON.stringify(year_s)
                  //'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
              },
              success: function (data) {   // `data` is from `get_topics_ajax` view function
                  let html_data_years = '<option value="">---------</option>';
                  let html_data_questions = '<option value="">---------</option>';
                  data.forEach(function (data) {
                      if (data.hasOwnProperty('survey_year')) {
                        html_data_years += `<option value="${data.survey_year}">${JSON.stringify(data.survey_year)}</option>`
                      }
                      if (data.hasOwnProperty('question_text')) {
                        html_data_questions += `<option value="${data.question_text}">${JSON.stringify(data.question_text)}</option>`
                      }
                  });
                  $('select[name=year-dropdown]').html(html_data_years); // replace the contents of the topic input with the data that came from the server
                  $('select[name=question-dropdown]').html(html_data_questions);

              }


          });
      });
  </script>













  {% endblock javascript %}

</body>

</html>